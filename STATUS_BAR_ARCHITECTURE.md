# Архитектура Статус Бара Подключения

## Диаграмма компонентов

```
┌─────────────────────────────────────────────────────────────┐
│                        MainWindow                           │
│                                                             │
│  ┌───────────────────────────┐  ┌──────────────────────┐  │
│  │      GameScreen           │  │   NetworkClient      │  │
│  │                           │  │                      │  │
│  │  ┌──────────────────┐    │  │  ConnectionStatus:   │  │
│  │  │   m_statusBar    │◄───┼──┼─ - Waiting          │  │
│  │  │   (QLabel)       │    │  │  - Connected        │  │
│  │  └──────────────────┘    │  │  - Error            │  │
│  │                           │  │  - Timeout          │  │
│  │  setConnectionStatus()    │  │  - Disconnected     │  │
│  └───────────────────────────┘  │                      │  │
│              ▲                   │  Callbacks/Signals   │  │
│              │                   └──────────────────────┘  │
│              │                            │                 │
│              └────────────────────────────┘                 │
│                   onConnectionStatusChanged()               │
└─────────────────────────────────────────────────────────────┘
```

## Поток данных

```
1. Запуск игры (showGameScreen)
   │
   ├─> NetworkClient::connectToServer()
   │
   └─> setStatus(Waiting) 
       │
       ├─> callback → MainWindow::onConnectionStatusChanged()
       │                │
       │                └─> GameScreen::setConnectionStatus(Waiting)
       │                    │
       │                    └─> Статус бар: "Ожидание..." (оранжевый)
       │
       └─> [1000ms delay]
           │
           └─> setStatus(Connected)
               │
               └─> callback → MainWindow::onConnectionStatusChanged()
                                │
                                └─> GameScreen::setConnectionStatus(Connected)
                                    │
                                    └─> Статус бар: "Подключено" (зелёный)

2. Выход из игры (onExitGameRequested)
   │
   └─> NetworkClient::disconnect()
       │
       └─> setStatus(Disconnected)
           │
           └─> callback → MainWindow::onConnectionStatusChanged()
                           │
                           └─> GameScreen::setConnectionStatus(Disconnected)
                               │
                               └─> Статус бар: "Разрыв связи" (серый)
```

## Цветовая схема статусов

| Статус         | Цвет             | RGB код  | Описание                    |
|----------------|------------------|----------|-----------------------------|
| Waiting        | Оранжевый        | #FFA500  | Ожидание подключения        |
| Connected      | Зелёный          | #4CAF50  | Успешное подключение        |
| Error          | Красный          | #F44336  | Ошибка подключения          |
| Timeout        | Оранжевый тёмнее | #FF9800  | Таймаут подключения         |
| Disconnected   | Серый            | #9E9E9E  | Разрыв соединения           |

## UI макет

```
┌────────────────────────────────────────────────────────────┐
│                        MainWindow                          │
│                                                            │
│  ┌──────────────┐              ┌──────────────┐          │
│  │   Ваше поле  │              │Поле противника│          │
│  ├──────────────┤              ├──────────────┤          │
│  │              │              │              │          │
│  │   10 x 10    │              │   10 x 10    │          │
│  │    грид      │              │    грид      │          │
│  │              │              │              │          │
│  └──────────────┘              └──────────────┘          │
│                                                            │
│  ┌──────────────────────┐           ┌─────────────────┐  │
│  │ Статус: Подключено   │  [stretch]│ Выход из игры   │  │
│  │    (зелёный фон)     │           └─────────────────┘  │
│  └──────────────────────┘                                 │
│         ▲                                                  │
│         └─── Статус бар слева от кнопки выхода            │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

## Ключевые особенности реализации

1. **Потокобезопасность**: Использование `QMetaObject::invokeMethod` для обновлений UI из callback'ов
2. **Разделение ответственности**: NetworkClient управляет логикой, GameScreen - отображением
3. **Расширяемость**: Легко добавить новые статусы или изменить визуализацию
4. **Тестируемость**: Методы симуляции позволяют тестировать все состояния
5. **Видимость**: Статус бар автоматически показывается при установке статуса

## Примеры использования

### Базовое использование
```cpp
// Подключение к серверу
m_networkClient->connectToServer("localhost", 12345);
// Статус автоматически меняется: Waiting -> Connected

// Отключение
m_networkClient->disconnect();
// Статус: Disconnected
```

### Симуляция ошибок
```cpp
// Симуляция таймаута
m_networkClient->simulateTimeout();
// Статус бар показывает "Таймаут" (оранжевый тёмнее)

// Симуляция ошибки
m_networkClient->simulateError();
// Статус бар показывает "Ошибка" (красный)
```

### Отслеживание статуса
```cpp
// Через callback
m_networkClient->setStatusCallback([](ConnectionStatus status) {
    // Обработка изменения статуса
});

// Получение текущего статуса
ConnectionStatus current = m_networkClient->getStatus();
```
